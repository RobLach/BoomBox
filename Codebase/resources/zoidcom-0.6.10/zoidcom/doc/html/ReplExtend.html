<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Zoidcom: Extended Object Information</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
  <script language="JavaScript">
    <!--
    var Img = new Array()
    function doc_image(dateiname)
    {
      this.normal     = new Image()
      this.high       = new Image()
      this.normal.src = dateiname + ".png"
      this.high.src   = dateiname + "h.png"
      return this
    }
    function load_images(name, dateiname)
    {
      Img[name] = new doc_image(dateiname)
    }
    function show_image(name)
    {
      document[name].src = Img[name].high.src
    }
    function hide_image(name)
    {
      document[name].src = Img[name].normal.src
    }
    load_images("Intro", "intro");
    load_images("Overview", "overview");
    load_images("Manual", "manual");
    load_images("Classes", "classref");
    load_images("Headers", "headref");
   -->
   </script>
</head><body>
	      <center>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" height="50">
        <tr height="50">
          <td width="42" height="50" background="headleft.png"></td>
          <td align="center" height="50" background="headback.png"><img src="headcenter.png" alt=""
              height="50" width="582"></td>
          <td width="42" height="50" background="headright.png"></td>
        </tr>
        <tr>
          <td colspan="3" align="center">
            <table width="212" border="0" cellspacing="0" cellpadding="0" align="center">
              <tr>
                <td><img src="linkleft.png" alt="" height="16" width="16" border="0"></td>
                <td><a href="index.html" onMouseOver="show_image('Intro')" onMouseOut="hide_image('Intro')"><img name="Intro" src="intro.png" alt="Introduction" height="16" width="108" border="0"></a></td>
                <td><a href="Manual.html" onMouseOver="show_image('Manual')" onMouseOut="hide_image('Manual')"><img name="Manual" src="manual.png" alt="Manual" height="16" width="108" border="0"></a></td>
                <td><a href="annotated.html" onMouseOver="show_image('Classes')"                         onMouseOut="hide_image('Classes')"><img name="Classes" src="classref.png" alt="Class Reference" height="16" width="108" border="0"></a></td>
                <td><a href="files.html" onMouseOver="show_image('Headers')"                                 onMouseOut="hide_image('Headers')"><img name="Headers" src="headref.png" alt="Header Reference" height="16" width="108" border="0"></a></td>
                <td><img src="linkright.png" alt="" height="16" width="16" border="0"></td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </center>
    
    
    
<!-- Generated by Doxygen 1.4.6-NO -->
<h1><a class="anchor" name="ReplExtend">Extended Object Information</a></h1><ul>
<li>
<a class="el" href="ReplIntro.html">Introduction</a>  </li>
<li>
<a class="el" href="ReplClasses.html">Classes And Class IDs</a>  </li>
<li>
<a class="el" href="ReplNodes.html">Adding The Nodes</a>  </li>
<li>
<a class="el" href="ReplZoidlevel.html">Entering Zoidmode</a>  </li>
<li>
<a class="el" href="ReplAnnounce.html">The Announcement</a>  </li>
<li>
<a class="el" href="ReplNodeEvents.html">Handling Node Events</a>  </li>
<li>
<a class="el" href="ReplNodeDeletion.html">Deleting The Server Nodes</a>  </li>
<li>
<a class="el" href="ReplExtend.html">Extended Object Information</a>  </li>
<li>
<a class="el" href="ReplSummary.html">Replication Summary</a>  </li>
</ul>
<h2><a class="anchor" name="replextendedintro">
Introduction</a></h2>
When an object is announced to a client, it might be necessary to have more information available than just a class ID. For these cases, it is possible to attach extended announcement data to a server node, which will always get sent along everytime this node is announced to a client.<h2><a class="anchor" name="replextendedhowto">
Attaching The Data</a></h2>
Two things need to be done.<p>
First, the class needs to be registered with the ZCOM_CLASSFLAG_ANNOUNCEDATA flag. <div class="fragment"><pre class="fragment">control-&gt;ZCom_registerClass(<span class="stringliteral">"Rock"</span>, <a class="code" href="zoidcom__control_8h.html#9b3055303bcc1fd79102c7b16063c40f">ZCOM_CLASSFLAG_ANNOUNCEDATA</a>);
</pre></div><p>
This flag needs to be present in the server and in the client registration of the class.<p>
Second, the data needs to be set with <a class="el" href="classZCom__Node.html#1a3f0186c9360e7cca4a6a5eff4800ec">ZCom_Node::setAnnounceData()</a>, on the server only! <div class="fragment"><pre class="fragment">node-&gt;registerNodeDynamic(control-&gt;ZCom_getClassID(<span class="stringliteral">"Rock"</span>), control);
<a class="code" href="classZCom__BitStream.html">ZCom_BitStream</a> *adata = <span class="keyword">new</span> <a class="code" href="classZCom__BitStream.html">ZCom_BitStream</a>();
<span class="keywordflow">if</span> (rock_is_black)
  adata-&gt;<a class="code" href="classZCom__BitStream.html#29e5fc2e9e2506c05fffee5f5e587426">addString</a>(<span class="stringliteral">"black"</span>);
<span class="keywordflow">else</span>
  adata-&gt;<a class="code" href="classZCom__BitStream.html#29e5fc2e9e2506c05fffee5f5e587426">addString</a>(<span class="stringliteral">"grey"</span>);
node-&gt;setAnnounceData(adata);
</pre></div><p>
Whenever the node gets announced to a client through either <a class="el" href="classZCom__Control.html#d35b06ce3554d7f5e7708b2808ac1069">ZCom_Control::ZCom_cbNodeRequest_Dynamic()</a> or <a class="el" href="classZCom__Control.html#f9409ade07a3279f2c00851128a6c077">ZCom_Control::ZCom_cbNodeRequest_Tag()</a>, the data that was set through setAnnounceData() is available in the _announcedata parameter of the two callbacks.<p>
<div class="fragment"><pre class="fragment"><span class="keyword">class </span>Client : <span class="keyword">public</span> <a class="code" href="classZCom__Control.html">ZCom_Control</a> {
  <span class="keywordtype">void</span> 
    ZCom_cbNodeRequest_Dynamic( <a class="code" href="zoidcom_8h.html#2fbc85318e50424694925feff4cb61e3">ZCom_ConnID</a> _id, <a class="code" href="zoidcom_8h.html#bad26ea4fa5a5da6a2f2ccc4c959f87e">ZCom_ClassID</a> _requested_class, <a class="code" href="classZCom__BitStream.html">ZCom_BitStream</a> *_announcedata,
                                <a class="code" href="zoidcom_8h.html#e5f7ff5ea0cb32c9b0310acab3f63a64">eZCom_NodeRole</a> _role, <a class="code" href="zoidcom_8h.html#c8ad2fe4d62c7d0ba133ecd24307a655">ZCom_NodeID</a> _net_id ) 
    {
      <span class="keywordflow">if</span> (_requested_class == Rock::getClassID())
      {
        <span class="keyword">const</span> <span class="keywordtype">char</span> *color = _announcedata-&gt;<a class="code" href="classZCom__BitStream.html#808c3d042677a0ca73c412a25b3dc5ba">getStringStatic</a>();
        Rock* rock = <span class="keyword">new</span> Rock(<span class="keyword">this</span>);
        <span class="comment">// assuming a method like this exists</span>
        rock-&gt;setColor(color);
      }
    }

  <span class="comment">// all other callback methods omitted here</span>
};
</pre></div><p>
Of course, sending a string to declare a color is a waste of bandwidth. In practice, the data should be compact as possible.<p>
<dl compact><dt><b>Attention:</b></dt><dd>When ZCOM_CLASSFLAG_ANNOUNCEDATA is used, all nodes of this class must have announcedata available. Also, the clients must always read the correct amount of bits from the _announcedata stream. If they read more or fewer bits than were provided by setAnnounceData(), Zoidcom will be unable to extract any more data from the currently processed packet and possibly close the connection. </dd></dl>
</td></tr></table>
<hr size="1"><address style="align: right;"><small>
This file is part of the documentation for Zoidcom. Documentation copyright © 2004-2008 by Jörg Rüppel. Generated on Sat Aug 16 15:26:51 2008 for Zoidcom by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6-NO</small></address>
</body>
</html>
