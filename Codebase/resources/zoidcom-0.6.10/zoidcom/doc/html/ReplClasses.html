<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Zoidcom: Classes And Class IDs</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
  <script language="JavaScript">
    <!--
    var Img = new Array()
    function doc_image(dateiname)
    {
      this.normal     = new Image()
      this.high       = new Image()
      this.normal.src = dateiname + ".png"
      this.high.src   = dateiname + "h.png"
      return this
    }
    function load_images(name, dateiname)
    {
      Img[name] = new doc_image(dateiname)
    }
    function show_image(name)
    {
      document[name].src = Img[name].high.src
    }
    function hide_image(name)
    {
      document[name].src = Img[name].normal.src
    }
    load_images("Intro", "intro");
    load_images("Overview", "overview");
    load_images("Manual", "manual");
    load_images("Classes", "classref");
    load_images("Headers", "headref");
   -->
   </script>
</head><body>
	      <center>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" height="50">
        <tr height="50">
          <td width="42" height="50" background="headleft.png"></td>
          <td align="center" height="50" background="headback.png"><img src="headcenter.png" alt=""
              height="50" width="582"></td>
          <td width="42" height="50" background="headright.png"></td>
        </tr>
        <tr>
          <td colspan="3" align="center">
            <table width="212" border="0" cellspacing="0" cellpadding="0" align="center">
              <tr>
                <td><img src="linkleft.png" alt="" height="16" width="16" border="0"></td>
                <td><a href="index.html" onMouseOver="show_image('Intro')" onMouseOut="hide_image('Intro')"><img name="Intro" src="intro.png" alt="Introduction" height="16" width="108" border="0"></a></td>
                <td><a href="Manual.html" onMouseOver="show_image('Manual')" onMouseOut="hide_image('Manual')"><img name="Manual" src="manual.png" alt="Manual" height="16" width="108" border="0"></a></td>
                <td><a href="annotated.html" onMouseOver="show_image('Classes')"                         onMouseOut="hide_image('Classes')"><img name="Classes" src="classref.png" alt="Class Reference" height="16" width="108" border="0"></a></td>
                <td><a href="files.html" onMouseOver="show_image('Headers')"                                 onMouseOut="hide_image('Headers')"><img name="Headers" src="headref.png" alt="Header Reference" height="16" width="108" border="0"></a></td>
                <td><img src="linkright.png" alt="" height="16" width="16" border="0"></td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </center>
    
    
    
<!-- Generated by Doxygen 1.4.6-NO -->
<h1><a class="anchor" name="ReplClasses">Classes And Class IDs</a></h1><ul>
<li>
<a class="el" href="ReplIntro.html">Introduction</a>  </li>
<li>
<a class="el" href="ReplClasses.html">Classes And Class IDs</a>  </li>
<li>
<a class="el" href="ReplNodes.html">Adding The Nodes</a>  </li>
<li>
<a class="el" href="ReplZoidlevel.html">Entering Zoidmode</a>  </li>
<li>
<a class="el" href="ReplAnnounce.html">The Announcement</a>  </li>
<li>
<a class="el" href="ReplNodeEvents.html">Handling Node Events</a>  </li>
<li>
<a class="el" href="ReplNodeDeletion.html">Deleting The Server Nodes</a>  </li>
<li>
<a class="el" href="ReplExtend.html">Extended Object Information</a>  </li>
<li>
<a class="el" href="ReplSummary.html">Replication Summary</a>  </li>
</ul>
<h2><a class="anchor" name="replidentifyclasses">
Identify Object Types</a></h2>
In order to be able to replicate objects, Zoidcom needs to be able to distinguish them. This is done by registering each type of the application's objects.<p>
If the game world consists of rocks and trees, we need to register two types: "Rock" and "Tree". This needs to be done on client and server. When a new tree object is created on the server, it will send the object type to the client, and only through the received object type it is possible for the client to actually know which object it is supposed to create. Object names will get mapped to ids internally, and even better, the ids have a dynamic size. If the world consists of four different object types, the type id sent with the object announcements uses only two bits of bandwidth!<h2><a class="anchor" name="replregisterclasses">
Register Object Types</a></h2>
For each object type, one call to ZCom_registerClass() is needed. The method is defined in <a class="el" href="classZCom__Control.html">ZCom_Control</a>. We are going to call it through the 'Server' and 'Client' class from previous chapters, as they are subclasses of ZCom_Control. It is necessary to register the same set of classes for the server and all clients. It is not necessary to register them in the same order, though.<p>
<div class="fragment"><pre class="fragment"><a class="code" href="zoidcom_8h.html#bad26ea4fa5a5da6a2f2ccc4c959f87e">ZCom_ClassID</a> rockid = server-&gt;ZCom_registerClass(<span class="stringliteral">"Rock"</span>);
<a class="code" href="zoidcom_8h.html#bad26ea4fa5a5da6a2f2ccc4c959f87e">ZCom_ClassID</a> treeid = server-&gt;ZCom_registerClass(<span class="stringliteral">"Tree"</span>);
</pre></div><p>
It is important to keep the returned ids, as they are needed when new objects are created on server and client. They can also be retrieved at a later point by calling:<p>
<div class="fragment"><pre class="fragment"><a class="code" href="zoidcom_8h.html#bad26ea4fa5a5da6a2f2ccc4c959f87e">ZCom_ClassID</a> rockid = server-&gt;ZCom_getClassID(<span class="stringliteral">"Rock"</span>);
</pre></div><p>
This is not encouraged, though, as it is slower to query the ids everytime when they are needed than to store them somewhere.<p>
<dl compact><dt><b>Attention:</b></dt><dd>Class IDs are not identical on client and server if their classes are not registered in the exact same order. If you need to send class IDs yourself for some reason, you either have to register all classes in the same order on all stations, or you have to send the class names (i.e. "Rock" and "Tree") as strings and then call ZCom_getClassID() on the other side. These are the only two ways to make sure, that server and client are talking about the same class.</dd></dl>
<h2><a class="anchor" name="replregisterclassdesign">
Sample Base</a></h2>
What follows is a basic class design that _could_ be used to handle registration of your object types aka classes to Zoidcom, and which stores the acquired class ids for later use. The following chapters will extend this code somewhat.<p>
<div class="fragment"><pre class="fragment"><span class="comment">// this code is not meant to be functional as it is</span>

<span class="comment">/******************* Base Object ********************/</span>

<span class="comment">// base game object</span>
<span class="keyword">class </span>GameObject
{
};

<span class="comment">/******************* Tree Object ********************/</span>

<span class="comment">// tree game object</span>
<span class="keyword">class </span>Tree : <span class="keyword">public</span> GameObject
{
  <span class="comment">// the class id for zoidcom</span>
  <span class="keyword">static</span> <a class="code" href="zoidcom_8h.html#bad26ea4fa5a5da6a2f2ccc4c959f87e">ZCom_ClassID</a>  m_classid;

<span class="keyword">public</span>:
  <span class="comment">// need this later</span>
  Tree(<a class="code" href="classZCom__Control.html">ZCom_Control</a> *_control);
  
  <span class="comment">// class registration</span>
  <span class="keyword">static</span> <span class="keywordtype">void</span> registerClass(<a class="code" href="classZCom__Control.html">ZCom_Control</a> *_control) {
    m_classid = _control-&gt;<a class="code" href="classZCom__Control.html#6cc1e6329c01f9df4176396bfcfc0501">ZCom_registerClass</a>(<span class="stringliteral">"Tree"</span>);
  }
  <span class="keyword">static</span> <a class="code" href="zoidcom_8h.html#bad26ea4fa5a5da6a2f2ccc4c959f87e">ZCom_ClassID</a> getClassID() { <span class="keywordflow">return</span> m_classid; }
};
<span class="comment">// declare static member</span>
<a class="code" href="zoidcom_8h.html#bad26ea4fa5a5da6a2f2ccc4c959f87e">ZCom_ClassID</a> Tree::m_classid = ZCom_Invalid_ID;

<span class="comment">/******************* Rock Object ********************/</span>

<span class="comment">// rock game object</span>
<span class="keyword">class </span>Rock : <span class="keyword">public</span> GameObject
{
  <span class="comment">// the class id for zoidcom</span>
  <span class="keyword">static</span> <a class="code" href="zoidcom_8h.html#bad26ea4fa5a5da6a2f2ccc4c959f87e">ZCom_ClassID</a>  m_classid;
<span class="keyword">public</span>:
  <span class="comment">// need this later</span>
  Rock(<a class="code" href="classZCom__Control.html">ZCom_Control</a> *_control);

  <span class="comment">// class registration</span>
  <span class="keyword">static</span> <span class="keywordtype">void</span> registerClass(<a class="code" href="classZCom__Control.html">ZCom_Control</a> *_control) {
    m_classid = _control-&gt;<a class="code" href="classZCom__Control.html#6cc1e6329c01f9df4176396bfcfc0501">ZCom_registerClass</a>(<span class="stringliteral">"Rock"</span>);
  }
  <span class="keyword">static</span> <a class="code" href="zoidcom_8h.html#bad26ea4fa5a5da6a2f2ccc4c959f87e">ZCom_ClassID</a> getClassID() { <span class="keywordflow">return</span> m_classid; }
};
<span class="comment">// declare static member</span>
<a class="code" href="zoidcom_8h.html#bad26ea4fa5a5da6a2f2ccc4c959f87e">ZCom_ClassID</a> Rock::m_classid = ZCom_Invalid_ID;


<span class="comment">/******************* Main ********************/</span>

<span class="keywordtype">int</span> main()
{
  <span class="comment">// &lt;- insert code from server example here</span>
  Server *server = <span class="keyword">new</span> Server();
  <span class="comment">// &lt;- insert code from server example here</span>

  <span class="comment">// register the object types with zoidcom</span>
  Tree::registerClass(server);
  Rock::registerClass(server);
  
  <span class="comment">// more to come</span>

}
</pre></div><p>
As you can see, the class registration and class id getter is the same for all classes, so code is duplicated alot. For sake of clarity, let us refrain from using C++ templates or macros to circumvent that code duplication.<p>
Please note that the above code will not work when client and server run in the same process, i.e. when the same class gets registered to two different <a class="el" href="classZCom__Control.html">ZCom_Control</a> objects. There is only one m_classid per C++ class, and if you register the class with the server <b>and</b> the client, you'd need a second one to store the id for that, too.<p>
<div class="fragment"><pre class="fragment"><span class="keyword">class </span>Tree
{
<span class="keyword">protected</span>:
  <span class="keyword">static</span> <a class="code" href="zoidcom_8h.html#bad26ea4fa5a5da6a2f2ccc4c959f87e">ZCom_ClassID</a> m_netclass_server_id;
  <span class="keyword">static</span> <a class="code" href="zoidcom_8h.html#bad26ea4fa5a5da6a2f2ccc4c959f87e">ZCom_ClassID</a> m_netclass_client_id;
<span class="keyword">public</span>:
  <span class="keyword">static</span> <a class="code" href="zoidcom_8h.html#bad26ea4fa5a5da6a2f2ccc4c959f87e">ZCom_ClassID</a> getNetClassID(<span class="keywordtype">bool</span> _server) {
    <span class="keywordflow">if</span> (_server)
      <span class="keywordflow">return</span> m_netclass_server_id;
    <span class="keywordflow">else</span>
      <span class="keywordflow">return</span> m_netclass_client_id;
  }
};
</pre></div><p>
The code in the following examples will be based on the simpler version using only one classid. </td></tr></table>
<hr size="1"><address style="align: right;"><small>
This file is part of the documentation for Zoidcom. Documentation copyright © 2004-2008 by Jörg Rüppel. Generated on Sat Aug 16 15:26:51 2008 for Zoidcom by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6-NO</small></address>
</body>
</html>
