<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Zoidcom: The Announcement</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
  <script language="JavaScript">
    <!--
    var Img = new Array()
    function doc_image(dateiname)
    {
      this.normal     = new Image()
      this.high       = new Image()
      this.normal.src = dateiname + ".png"
      this.high.src   = dateiname + "h.png"
      return this
    }
    function load_images(name, dateiname)
    {
      Img[name] = new doc_image(dateiname)
    }
    function show_image(name)
    {
      document[name].src = Img[name].high.src
    }
    function hide_image(name)
    {
      document[name].src = Img[name].normal.src
    }
    load_images("Intro", "intro");
    load_images("Overview", "overview");
    load_images("Manual", "manual");
    load_images("Classes", "classref");
    load_images("Headers", "headref");
   -->
   </script>
</head><body>
	      <center>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" height="50">
        <tr height="50">
          <td width="42" height="50" background="headleft.png"></td>
          <td align="center" height="50" background="headback.png"><img src="headcenter.png" alt=""
              height="50" width="582"></td>
          <td width="42" height="50" background="headright.png"></td>
        </tr>
        <tr>
          <td colspan="3" align="center">
            <table width="212" border="0" cellspacing="0" cellpadding="0" align="center">
              <tr>
                <td><img src="linkleft.png" alt="" height="16" width="16" border="0"></td>
                <td><a href="index.html" onMouseOver="show_image('Intro')" onMouseOut="hide_image('Intro')"><img name="Intro" src="intro.png" alt="Introduction" height="16" width="108" border="0"></a></td>
                <td><a href="Manual.html" onMouseOver="show_image('Manual')" onMouseOut="hide_image('Manual')"><img name="Manual" src="manual.png" alt="Manual" height="16" width="108" border="0"></a></td>
                <td><a href="annotated.html" onMouseOver="show_image('Classes')"                         onMouseOut="hide_image('Classes')"><img name="Classes" src="classref.png" alt="Class Reference" height="16" width="108" border="0"></a></td>
                <td><a href="files.html" onMouseOver="show_image('Headers')"                                 onMouseOut="hide_image('Headers')"><img name="Headers" src="headref.png" alt="Header Reference" height="16" width="108" border="0"></a></td>
                <td><img src="linkright.png" alt="" height="16" width="16" border="0"></td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </center>
    
    
    
<!-- Generated by Doxygen 1.4.6-NO -->
<h1><a class="anchor" name="ReplAnnounce">The Announcement</a></h1><ul>
<li>
<a class="el" href="ReplIntro.html">Introduction</a>  </li>
<li>
<a class="el" href="ReplClasses.html">Classes And Class IDs</a>  </li>
<li>
<a class="el" href="ReplNodes.html">Adding The Nodes</a>  </li>
<li>
<a class="el" href="ReplZoidlevel.html">Entering Zoidmode</a>  </li>
<li>
<a class="el" href="ReplAnnounce.html">The Announcement</a>  </li>
<li>
<a class="el" href="ReplNodeEvents.html">Handling Node Events</a>  </li>
<li>
<a class="el" href="ReplNodeDeletion.html">Deleting The Server Nodes</a>  </li>
<li>
<a class="el" href="ReplExtend.html">Extended Object Information</a>  </li>
<li>
<a class="el" href="ReplSummary.html">Replication Summary</a>  </li>
</ul>
<h2><a class="anchor" name="replannounce">
The Announcement</a></h2>
An announcement occurs, when the server replicates an object to a client. These announcements are handled in different ways depending on the replicated node's replication mode.<p>
<ul>
<li>With unique replication, the client counterpart node and it's object are expected to be registered on the client already when the annoucement arrives. No additional action needs to be performed by the application.</li></ul>
<p>
<ul>
<li>Announcements of dynamically replicated nodes need to be handled by the application as soon as they arrive. They generate the callback ZCom_cbNodeRequest_Dynamic() in <a class="el" href="classZCom__Control.html">ZCom_Control</a>. The name says everything, the callback requests the creation of a node. It has to be implemented just like the other callbacks in the Client and Server sections(<a class="el" href="Server.html">The Server</a>, <a class="el" href="Client.html">The Client</a>). If a dynamic node is requested but the callback does not create that node, the connection will fail.</li></ul>
<p>
<ul>
<li>Tagmode replicated nodes can generate a callback, too, but only if the requested node is not registered before the announcement arrives. The callback for these nodes is ZCom_cbNodeRequest_Tag().</li></ul>
<h2><a class="anchor" name="replcallbackproto">
Callback Prototype</a></h2>
We are going to extend the client class from earlier. As you know, many callbacks were left unimplemented there, and here one of these callbacks will get an implementation. Announcements of dynamic nodes can be handled properly as soon as we implemented it.<p>
This is the prototype of the method: <div class="fragment"><pre class="fragment"><span class="keyword">class </span>Client : <span class="keyword">public</span> <a class="code" href="classZCom__Control.html">ZCom_Control</a> {
  <span class="keywordtype">void</span> 
    ZCom_cbNodeRequest_Dynamic( <a class="code" href="zoidcom_8h.html#2fbc85318e50424694925feff4cb61e3">ZCom_ConnID</a> _id, <a class="code" href="zoidcom_8h.html#bad26ea4fa5a5da6a2f2ccc4c959f87e">ZCom_ClassID</a> _requested_class, <a class="code" href="classZCom__BitStream.html">ZCom_BitStream</a> *_announcedata,
                                <a class="code" href="zoidcom_8h.html#e5f7ff5ea0cb32c9b0310acab3f63a64">eZCom_NodeRole</a> _role, <a class="code" href="zoidcom_8h.html#c8ad2fe4d62c7d0ba133ecd24307a655">ZCom_NodeID</a> _net_id ) 
    {
    }

  <span class="comment">// all other callback methods omitted here</span>
};
</pre></div><p>
The parameters to the callback give information about the connection id from which the announcement came (typically always the same id, since there seldomly are connections to several servers at once), the class id, the role which the new node will possess (either eZCom_RoleProxy or eZCom_RoleOwner), the new node's network id and a custom bitstream that can be attached when the node is registered on the server.<h2><a class="anchor" name="replcallbackimpl">
Example Callback Implementation</a></h2>
The most important information is the _requested_class parameter. This equals one of the class ids we got by calling ZCom_registerClass() before. We are expected to create one instance of the requested class, so building on top of the Rock and Tree code again, here goes a simple implementation:<p>
<div class="fragment"><pre class="fragment"><span class="keywordtype">void</span> <a class="code" href="classZCom__Control.html#d35b06ce3554d7f5e7708b2808ac1069">Client::ZCom_cbNodeRequest_Dynamic</a>( 
                   <a class="code" href="zoidcom_8h.html#2fbc85318e50424694925feff4cb61e3">ZCom_ConnID</a> _id, <a class="code" href="zoidcom_8h.html#bad26ea4fa5a5da6a2f2ccc4c959f87e">ZCom_ClassID</a> _requested_class, <a class="code" href="classZCom__BitStream.html">ZCom_BitStream</a> *_announcedata,
                   <a class="code" href="zoidcom_8h.html#e5f7ff5ea0cb32c9b0310acab3f63a64">eZCom_NodeRole</a> _role, <a class="code" href="zoidcom_8h.html#c8ad2fe4d62c7d0ba133ecd24307a655">ZCom_NodeID</a> _net_id ) 
{
  <span class="keywordflow">if</span> (_requested_class == Tree::getClassID()) 
    <span class="comment">// create tree and register it with the client, i.e. 'this'</span>
    Tree* tree = <span class="keyword">new</span> Tree(<span class="keyword">this</span>);
  <span class="keywordflow">else</span>
  <span class="keywordflow">if</span> (_requested_class == Rock::getClassID()) 
    <span class="comment">// create rock and register it with the client, i.e. 'this'</span>
    Rock* rock = <span class="keyword">new</span> Rock(<span class="keyword">this</span>);
};
</pre></div><p>
That handles the creation of requested Rocks and Trees. Whenever the server creates one of these and thinks the client should have it, this callback is called, asking the client to create the object and register it's node. </td></tr></table>
<hr size="1"><address style="align: right;"><small>
This file is part of the documentation for Zoidcom. Documentation copyright © 2004-2008 by Jörg Rüppel. Generated on Sat Aug 16 15:26:51 2008 for Zoidcom by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6-NO</small></address>
</body>
</html>
