<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Zoidcom: File Transfer</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
  <script language="JavaScript">
    <!--
    var Img = new Array()
    function doc_image(dateiname)
    {
      this.normal     = new Image()
      this.high       = new Image()
      this.normal.src = dateiname + ".png"
      this.high.src   = dateiname + "h.png"
      return this
    }
    function load_images(name, dateiname)
    {
      Img[name] = new doc_image(dateiname)
    }
    function show_image(name)
    {
      document[name].src = Img[name].high.src
    }
    function hide_image(name)
    {
      document[name].src = Img[name].normal.src
    }
    load_images("Intro", "intro");
    load_images("Overview", "overview");
    load_images("Manual", "manual");
    load_images("Classes", "classref");
    load_images("Headers", "headref");
   -->
   </script>
</head><body>
	      <center>
        <table width="100%" border="0" cellspacing="0" cellpadding="0" height="50">
        <tr height="50">
          <td width="42" height="50" background="headleft.png"></td>
          <td align="center" height="50" background="headback.png"><img src="headcenter.png" alt=""
              height="50" width="582"></td>
          <td width="42" height="50" background="headright.png"></td>
        </tr>
        <tr>
          <td colspan="3" align="center">
            <table width="212" border="0" cellspacing="0" cellpadding="0" align="center">
              <tr>
                <td><img src="linkleft.png" alt="" height="16" width="16" border="0"></td>
                <td><a href="index.html" onMouseOver="show_image('Intro')" onMouseOut="hide_image('Intro')"><img name="Intro" src="intro.png" alt="Introduction" height="16" width="108" border="0"></a></td>
                <td><a href="Manual.html" onMouseOver="show_image('Manual')" onMouseOut="hide_image('Manual')"><img name="Manual" src="manual.png" alt="Manual" height="16" width="108" border="0"></a></td>
                <td><a href="annotated.html" onMouseOver="show_image('Classes')"                         onMouseOut="hide_image('Classes')"><img name="Classes" src="classref.png" alt="Class Reference" height="16" width="108" border="0"></a></td>
                <td><a href="files.html" onMouseOver="show_image('Headers')"                                 onMouseOut="hide_image('Headers')"><img name="Headers" src="headref.png" alt="Header Reference" height="16" width="108" border="0"></a></td>
                <td><img src="linkright.png" alt="" height="16" width="16" border="0"></td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </center>
    
    
    
<!-- Generated by Doxygen 1.4.6-NO -->
<h1><a class="anchor" name="FileTransfer">File Transfer</a></h1>File transfers are not implemented between controls but between nodes, building on top of ZCom_Node's event system. That means, file transfers will get prioritized by the node's priority and connection specific relevance. Additionally, a file transfer itself has an aggressivenes option which influences how big the sent chunks are. The bigger the chunks, the lower the amount of space left in the current packet for other nodes. When having a low node priority but aggressivenes is 1.0, the file transfer will occupy a whole packet once in a while, whereas a high node priority with a low aggressivenes will transfer small chunks of the file but with a higher frequency.<p>
To start a filetransfer, you will need two nodes connected to each other. The direction of file transfers is not restricted. Let's call the nodes 'snode' for the node on the server and 'cnode' for the client. File transfer basically involves two special methods in ZCom_Node plus handling of some node events.<p>
<div class="fragment"><pre class="fragment">snode-&gt;sendFile(<span class="stringliteral">"./data/the_file.txt"</span>,          <span class="comment">// path to file in local filesystem</span>
                <span class="stringliteral">"the_file.txt"</span>,                 <span class="comment">// path the receiver will see</span>
                1,                              <span class="comment">// connection ID of destination node</span>
                NULL,                           <span class="comment">// meta information can be optionally sent via ZCom_BitStream</span>
                1.0f);                          <span class="comment">// aggressivenes</span>
</pre></div><p>
It is not possible to send a file to all nodes at once, so sendFile() needs a target connection id. Cnode will receive the event ZCom_Node::eEvent_File_Incoming eventually.<p>
<div class="fragment"><pre class="fragment"><a class="code" href="zoidcom_8h.html#e31c5d3b58d9e6a36c310277cdea7e0b">eZCom_Event</a>       type;            <span class="comment">// event type</span>
<a class="code" href="zoidcom_8h.html#2fbc85318e50424694925feff4cb61e3">ZCom_ConnID</a>       conn_id;         <span class="comment">// connection id of sender</span>

<a class="code" href="classZCom__BitStream.html">ZCom_BitStream</a> *data = cnode-&gt;getNextEvent(&amp;type, NULL, &amp;conn_id);
<span class="keywordflow">if</span> (type == <a class="code" href="zoidcom_8h.html#e31c5d3b58d9e6a36c310277cdea7e0bf2e05687ad6575d856f0c3956247ec0d">eZCom_EventFile_Incoming</a> &amp;&amp; data)
{
  <a class="code" href="zoidcom_8h.html#bf82e62bf861c93bb9816356c001e9b9">ZCom_FileTransID</a> fid = (<a class="code" href="zoidcom_8h.html#bf82e62bf861c93bb9816356c001e9b9">ZCom_FileTransID</a>) data-&gt;<a class="code" href="classZCom__BitStream.html#0cc7eb67c7fba69253fe6637957484fd">getInt</a>(<a class="code" href="zoidcom__node_8h.html#4a8937d0c9f74170bc9f47a3c8e64ffc">ZCOM_FTRANS_ID_BITS</a>);
  <a class="code" href="structZCom__FileTransInfo.html">ZCom_FileTransInfo</a> info = node-&gt;getFileInfo(fid);
  <span class="keywordflow">if</span> (info.<a class="code" href="structZCom__FileTransInfo.html#1e15adc99e4308db12fa21a4222b90b7">id</a> == ZCom_Invalid_ID) {
    <span class="comment">// there was an error</span>
  } <span class="keywordflow">else</span> {
    <span class="comment">// accept the file</span>
    <span class="comment">// NULL as 3rd parameter instructs zoidcom to store it</span>
    <span class="comment">// to the location proposed by the sender</span>
    node-&gt;acceptFile(conn_id, fid, NULL, <span class="keyword">true</span>);
  }
}
</pre></div><p>
The attached bitstream returned by getNextEvent() contains as first info, the file transfer ID. Together with the sender's connection ID, the file transfer can be uniquely identified. All other information about this file transfer is stored inside the <a class="el" href="structZCom__FileTransInfo.html">ZCom_FileTransInfo</a> structure, which can be retrieved at any time as long as the filetransfer is valid. For the sender that means between the call to sendFile() and the receival of either eZCom_EventFile_Aborted or eZCom_EventFile_Complete. For the receiver it means between the receival of eZCom_EventFile_Incoming and aborting it via acceptFile(.., false) or the receival of eZCom_EventFile_Aborted due to an error. If file transfer information is not available, the struct will have ZCom_Invalid_ID in the ID field.<p>
If the sender supplied metadata to the data parameter in sendFile(), this can be extracted from the bitstream after reading the file transfer ID.<p>
To accept or deny a file transfer, <a class="el" href="classZCom__Node.html#ba092e450e1b9028a46f27a62d53a96b">ZCom_Node::acceptFile()</a> needs to be called. The first two parameters describe the file transfer in question, the third is a const char *, and if non-NULL, describes where Zoidcom should store the file. If NULL, it will be stored in the supplied location aka <a class="el" href="structZCom__FileTransInfo.html#a5084917f19d32b0eb4ff2cb818d5c5a">ZCom_FileTransInfo::path</a> aka parameter _pathtosend to sendFile().<p>
The last parameter to acceptFile() is a bool, say 'true' to accept or 'false' to deny the transfer. In latter case, eEvent_File_Aborted will be received by the sender. This also happens if the client is unable to open the target file or write to it during transfer.<p>
For each chunk received during transfer, eEvent_File_Data is generated on the client, not containing the received data, but merely serving as progress notification. After transmission of the whole file, eEvent_File_Complete is received on both client and server. </td></tr></table>
<hr size="1"><address style="align: right;"><small>
This file is part of the documentation for Zoidcom. Documentation copyright © 2004-2008 by Jörg Rüppel. Generated on Sat Aug 16 15:26:51 2008 for Zoidcom by&nbsp;<a href="http://www.doxygen.org/index.html"><img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.6-NO</small></address>
</body>
</html>
